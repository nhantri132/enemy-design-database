<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enemy Design Database</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
        }

        header h1 {
            text-align: center;
            font-size: 2em;
        }

        .auth-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .user-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .user-details {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .sign-in-prompt {
            background: white;
            padding: 40px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .sign-in-prompt h2 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .sign-in-prompt p {
            margin-bottom: 20px;
            color: #7f8c8d;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 10px;
        }

        .search-box {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .btn {
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .form-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-section.hidden {
            display: none;
        }

        .form-section h2 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .enemy-list {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .enemy-card {
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }

        .enemy-card:hover {
            background: #f9f9f9;
        }

        .enemy-card:last-child {
            border-bottom: none;
        }

        .enemy-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .enemy-title {
            flex: 1;
        }

        .enemy-title h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .enemy-game {
            color: #7f8c8d;
            font-size: 14px;
        }

        .enemy-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            background: #ecf0f1;
            color: #555;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge.type { background: #3498db; color: white; }
        .badge.size { background: #9b59b6; color: white; }
        .badge.weapon { background: #e67e22; color: white; }

        .enemy-notes {
            margin-top: 10px;
            color: #555;
            font-size: 14px;
            line-height: 1.5;
        }

        .enemy-links {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .enemy-links a {
            color: #3498db;
            text-decoration: none;
            font-size: 14px;
        }

        .enemy-links a:hover {
            text-decoration: underline;
        }

        .enemy-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .enemy-actions button {
            padding: 6px 12px;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #95a5a6;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        .stats {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stats h3 {
            color: #2c3e50;
            font-size: 2em;
        }

        .stats p {
            color: #7f8c8d;
        }

        .migration-banner {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .migration-banner.hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>🎮 Enemy Design Database</h1>
        </div>
    </header>

    <div class="container">
        <!-- Auth Section -->
        <div id="authSection"></div>

        <!-- Migration Banner -->
        <div id="migrationBanner" class="migration-banner hidden">
            <div>
                <strong>Local data found!</strong> You have enemies saved locally. Migrate them to the cloud?
            </div>
            <button class="btn btn-success" onclick="migrateLocalData()">Migrate Now</button>
        </div>

        <!-- Stats -->
        <div class="stats">
            <h3 id="enemyCount">-</h3>
            <p>Enemies Cataloged</p>
        </div>

        <!-- Main Content (hidden until loaded) -->
        <div id="mainContent" class="loading">
            <p>Loading...</p>
        </div>

        <!-- Controls -->
        <div class="controls hidden" id="controls">
            <input type="text" id="searchBox" class="search-box" placeholder="Search by enemy name or game...">
            <button class="btn" id="addNewBtn" disabled>+ Add New Enemy</button>
        </div>

        <!-- Form -->
        <div class="form-section hidden" id="formSection">
            <h2 id="formTitle">Add New Enemy</h2>
            <form id="enemyForm">
                <div class="form-group">
                    <label for="enemyName">Enemy Name *</label>
                    <input type="text" id="enemyName" required>
                </div>

                <div class="form-group">
                    <label for="gameName">Game *</label>
                    <input type="text" id="gameName" required>
                </div>

                <div class="form-group">
                    <label for="enemyType">Enemy Type</label>
                    <select id="enemyType">
                        <option value="">Select type...</option>
                        <option value="Regular">Regular</option>
                        <option value="Elite">Elite</option>
                        <option value="Mini-Boss">Mini-Boss</option>
                        <option value="Boss">Boss</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="enemySize">Enemy Size</label>
                    <select id="enemySize">
                        <option value="">Select size...</option>
                        <option value="Tiny">Tiny</option>
                        <option value="Small">Small</option>
                        <option value="Medium">Medium</option>
                        <option value="Large">Large</option>
                        <option value="Huge">Huge</option>
                        <option value="Gargantuan">Gargantuan</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="enemyWeapon">Weapon Type</label>
                    <input type="text" id="enemyWeapon" list="weaponOptions" placeholder="Select or type custom weapon...">
                    <datalist id="weaponOptions">
                        <option value="One-handed">
                        <option value="Two-handed">
                        <option value="Dual-wield">
                        <option value="Ranged">
                        <option value="Magic/Casting">
                        <option value="Unarmed">
                        <option value="Natural weapons (claws, teeth, etc.)">
                        <option value="Environmental">
                    </datalist>
                </div>

                <div class="form-group">
                    <label for="referenceLink">Reference Link</label>
                    <input type="url" id="referenceLink" placeholder="https://wiki.example.com/enemy">
                </div>

                <div class="form-group">
                    <label for="videoLink">Video Reference</label>
                    <input type="url" id="videoLink" placeholder="https://youtube.com/...">
                </div>

                <div class="form-group">
                    <label for="imageLink">Image Reference</label>
                    <input type="url" id="imageLink" placeholder="https://example.com/image.jpg">
                </div>

                <div class="form-group">
                    <label for="notes">Notes & Analysis</label>
                    <textarea id="notes" placeholder="Your observations about this enemy's design..."></textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn" id="saveBtn">Save Enemy</button>
                    <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                </div>
            </form>
        </div>

        <!-- Enemy List -->
        <div class="enemy-list" id="enemyList"></div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAyBO6IwnOdqFbC7Hf65sifksRDaKnjZmM",
            authDomain: "enemy-design-database.firebaseapp.com",
            databaseURL: "https://enemy-design-database-default-rtdb.firebaseio.com",
            projectId: "enemy-design-database",
            storageBucket: "enemy-design-database.firebasestorage.app",
            messagingSenderId: "652811505513",
            appId: "1:652811505513:web:cbe13d7665b4fa991177f8"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // State
        let currentUser = null;
        let enemies = {};
        let editingKey = null;

        // Auth state observer
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            renderAuthSection();
            
            if (user) {
                loadEnemies();
                checkForLocalData();
            } else {
                document.getElementById('mainContent').innerHTML = '';
                document.getElementById('controls').classList.add('hidden');
            }
        });

        // Render auth section
        function renderAuthSection() {
            const authSection = document.getElementById('authSection');
            
            if (currentUser) {
                authSection.innerHTML = `
                    <div class="user-info">
                        <div class="user-details">
                            <img src="${currentUser.photoURL}" alt="${currentUser.displayName}" class="user-avatar">
                            <div>
                                <strong>${currentUser.displayName}</strong>
                                <div style="font-size: 12px; color: #7f8c8d;">${currentUser.email}</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="signOut()">Sign Out</button>
                    </div>
                `;
                document.getElementById('addNewBtn').disabled = false;
            } else {
                authSection.innerHTML = `
                    <div class="sign-in-prompt">
                        <h2>Welcome to Enemy Design Database</h2>
                        <p>Sign in with Google to add and edit enemies. Anyone can view the database.</p>
                        <button class="btn" onclick="signIn()">Sign in with Google</button>
                    </div>
                `;
                document.getElementById('addNewBtn').disabled = true;
            }
        }

        // Sign in
        function signIn() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch((error) => {
                alert('Sign in failed: ' + error.message);
            });
        }

        // Sign out
        function signOut() {
            auth.signOut();
        }

        // Check for local data
        function checkForLocalData() {
            const localData = localStorage.getItem('enemyDatabase');
            if (localData) {
                const localEnemies = JSON.parse(localData);
                if (localEnemies.length > 0) {
                    document.getElementById('migrationBanner').classList.remove('hidden');
                }
            }
        }

        // Migrate local data
        function migrateLocalData() {
            const localData = localStorage.getItem('enemyDatabase');
            if (!localData) return;
            
            const localEnemies = JSON.parse(localData);
            const enemiesRef = database.ref('enemies');
            
            let migrated = 0;
            localEnemies.forEach((enemy) => {
                enemiesRef.push(enemy);
                migrated++;
            });
            
            localStorage.removeItem('enemyDatabase');
            document.getElementById('migrationBanner').classList.add('hidden');
            alert(`Successfully migrated ${migrated} enemies to the cloud!`);
        }

        // Load enemies from Firebase
        function loadEnemies() {
            const enemiesRef = database.ref('enemies');
            
            enemiesRef.on('value', (snapshot) => {
                enemies = snapshot.val() || {};
                renderEnemies();
                updateCount();
                document.getElementById('mainContent').innerHTML = '';
                document.getElementById('controls').classList.remove('hidden');
            });
        }

        // Update count
        function updateCount() {
            const count = Object.keys(enemies).length;
            document.getElementById('enemyCount').textContent = count;
        }

        // Show form
        function showForm(isEdit = false, key = null) {
            if (!currentUser) {
                alert('Please sign in to add or edit enemies.');
                return;
            }

            const formSection = document.getElementById('formSection');
            const formTitle = document.getElementById('formTitle');
            const form = document.getElementById('enemyForm');
            
            formSection.classList.remove('hidden');
            formTitle.textContent = isEdit ? 'Edit Enemy' : 'Add New Enemy';
            
            if (isEdit && key) {
                editingKey = key;
                const enemy = enemies[key];
                document.getElementById('enemyName').value = enemy.name;
                document.getElementById('gameName').value = enemy.game;
                document.getElementById('enemyType').value = enemy.type || '';
                document.getElementById('enemySize').value = enemy.size || '';
                document.getElementById('enemyWeapon').value = enemy.weapon || '';
                document.getElementById('referenceLink').value = enemy.referenceLink || '';
                document.getElementById('videoLink').value = enemy.videoLink || '';
                document.getElementById('imageLink').value = enemy.imageLink || '';
                document.getElementById('notes').value = enemy.notes || '';
            } else {
                editingKey = null;
                form.reset();
            }
            
            formSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Hide form
        function hideForm() {
            document.getElementById('formSection').classList.add('hidden');
            document.getElementById('enemyForm').reset();
            editingKey = null;
        }

        // Render enemies
        function renderEnemies(searchTerm = '') {
            const listContainer = document.getElementById('enemyList');
            
            let enemyArray = Object.keys(enemies).map(key => ({
                key: key,
                ...enemies[key]
            }));
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                enemyArray = enemyArray.filter(enemy => 
                    enemy.name.toLowerCase().includes(term) ||
                    enemy.game.toLowerCase().includes(term)
                );
            }
            
            if (enemyArray.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>${searchTerm ? 'No enemies found' : 'No enemies yet'}</h3>
                        <p>${searchTerm ? 'Try a different search term' : currentUser ? 'Click "Add New Enemy" to get started' : 'Sign in to add enemies'}</p>
                    </div>
                `;
                return;
            }
            
            listContainer.innerHTML = enemyArray.map((enemy) => {
                let badges = '';
                if (enemy.type) badges += `<span class="badge type">${enemy.type}</span>`;
                if (enemy.size) badges += `<span class="badge size">${enemy.size}</span>`;
                if (enemy.weapon) badges += `<span class="badge weapon">${enemy.weapon}</span>`;
                
                let links = '';
                if (enemy.referenceLink) links += `<a href="${enemy.referenceLink}" target="_blank">📚 Wiki</a>`;
                if (enemy.videoLink) links += `<a href="${enemy.videoLink}" target="_blank">🎥 Video</a>`;
                if (enemy.imageLink) links += `<a href="${enemy.imageLink}" target="_blank">🖼️ Image</a>`;
                
                const actions = currentUser ? `
                    <div class="enemy-actions">
                        <button class="btn btn-secondary" onclick="editEnemy('${enemy.key}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteEnemy('${enemy.key}')">Delete</button>
                    </div>
                ` : '';
                
                return `
                    <div class="enemy-card">
                        <div class="enemy-header">
                            <div class="enemy-title">
                                <h3>${enemy.name}</h3>
                                <div class="enemy-game">${enemy.game}</div>
                            </div>
                        </div>
                        ${badges ? `<div class="enemy-badges">${badges}</div>` : ''}
                        ${enemy.notes ? `<div class="enemy-notes">${enemy.notes}</div>` : ''}
                        ${links ? `<div class="enemy-links">${links}</div>` : ''}
                        ${actions}
                    </div>
                `;
            }).join('');
        }

        // Add/Edit enemy
        document.getElementById('enemyForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (!currentUser) {
                alert('Please sign in to save enemies.');
                return;
            }
            
            const enemy = {
                name: document.getElementById('enemyName').value,
                game: document.getElementById('gameName').value,
                type: document.getElementById('enemyType').value,
                size: document.getElementById('enemySize').value,
                weapon: document.getElementById('enemyWeapon').value,
                referenceLink: document.getElementById('referenceLink').value,
                videoLink: document.getElementById('videoLink').value,
                imageLink: document.getElementById('imageLink').value,
                notes: document.getElementById('notes').value,
                createdBy: currentUser.uid,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            const enemiesRef = database.ref('enemies');
            
            if (editingKey) {
                enemiesRef.child(editingKey).update(enemy);
            } else {
                enemiesRef.push(enemy);
            }
            
            hideForm();
        });

        // Edit enemy
        function editEnemy(key) {
            showForm(true, key);
        }

        // Delete enemy
        function deleteEnemy(key) {
            if (!currentUser) {
                alert('Please sign in to delete enemies.');
                return;
            }
            
            if (confirm('Are you sure you want to delete this enemy?')) {
                database.ref('enemies/' + key).remove();
            }
        }

        // Event listeners
        document.getElementById('addNewBtn').addEventListener('click', () => showForm());
        document.getElementById('cancelBtn').addEventListener('click', hideForm);
        document.getElementById('searchBox').addEventListener('input', (e) => {
            renderEnemies(e.target.value);
        });
    </script>
</body>
</html>
